(this.webpackJsonptrailcam=this.webpackJsonptrailcam||[]).push([[0],{133:function(e,t,r){"use strict";r.r(t);var n=r(0),a=r.n(n),c=r(37),s=r.n(c),i=r(27),o=r(5),u=r.n(o),d=r(10),l=r(22),j=r(9),b=r(28),p=r(64),g=r(57),x=r(42),h=r(61),O=r(62),f=r(3),m=function(e){var t=e.loginUser,r=Object(n.useState)(!1),a=Object(l.a)(r,2),c=a[0],s=a[1],i=function(){var e=Object(d.a)(u.a.mark((function e(r){var n,a,c,s;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.preventDefault(),n=r.target.elements,a=n.email,c=n.password,s={email:a.value,password:c.value},a.value="",c.value="",e.next=7,t(s);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(f.jsx)(g.q,{children:Object(f.jsxs)("form",{name:"login-form",onSubmit:i,children:[Object(f.jsxs)(x.a,{id:"email",children:[Object(f.jsx)(x.b,{children:"Email"}),Object(f.jsx)(h.a,{variant:"outline",name:"email",type:"text",placeholder:"Email"})]}),Object(f.jsxs)(x.a,{id:"password",children:[Object(f.jsx)(x.b,{children:"Password"}),Object(f.jsxs)(h.b,{children:[Object(f.jsx)(h.a,{variant:"outline",name:"password",type:c?"text":"password",placeholder:"Password"}),Object(f.jsx)(h.c,{children:Object(f.jsx)(O.a,{onClick:function(){s(!c)},children:c?"Hide":"Show"})})]})]}),Object(f.jsx)(O.a,{variant:"solid",name:"login-button",type:"submit",children:"Login"})]})})},v=r(30),y=r(63),w=r(74),k=r(35),P=a.a.forwardRef((function(e,t){return Object(f.jsxs)(g.e,{as:"button",name:e.name,onClick:e.onClick,ref:t,children:[Object(f.jsx)(y.a,{name:e.children.props.children,size:"sm",src:""}),Object(f.jsx)(g.p,{children:e.children.props.children})]})})),D=function(e){var t=e.user,r=e.logout,n=function(){var e=Object(d.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r();case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(f.jsx)(g.d,{alignItems:"center",justifyContent:"space-between",children:Object(f.jsxs)(w.a,{children:[Object(f.jsx)(w.b,{name:"user-avatar",as:P,rounded:"full",variant:"link",cursor:"pointer",minW:0,children:t.name}),Object(f.jsxs)(w.e,{name:"user-menu",children:["admin"===t.role?Object(f.jsx)(w.d,{children:"Settings"}):Object(f.jsx)(f.Fragment,{}),Object(f.jsx)(w.d,{children:"Profile"}),Object(f.jsx)(w.c,{}),Object(f.jsx)(w.d,{name:"user-logout",onClick:n,children:"Logout"})]})]})})},L=function(e){var t,r=e.loading,n=e.user,a=e.logout,c=Object(f.jsx)(p.a,{height:"20px"}),s=Object(f.jsx)(g.a,{sx:(t={position:"-webkit-sticky"},Object(v.a)(t,"position","sticky"),Object(v.a)(t,"top",0),Object(v.a)(t,"z-index",1),t),name:"app-header",bg:Object(k.c)("gray.100","gray.900"),px:4,children:Object(f.jsxs)(g.d,{h:16,alignItems:"center",justifyContent:"space-between",children:[Object(f.jsx)(g.f,{children:Object(f.jsx)(g.g,{_hover:{textDecoration:"none"},href:"#top",children:"TrailCam"})}),Object(f.jsx)(g.n,{}),null!==n?Object(f.jsx)(D,{user:n,logout:a}):Object(f.jsx)(f.Fragment,{})]})});return r?c:s},S=r(39),I=r(45),F=r(73),R=r(20),C=r(26),T=r.n(C),U="/api/recordings",q=function(){var e=Object(d.a)(u.a.mark((function e(){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,T.a.get(U);case 2:return t=e.sent,e.abrupt("return",t.data);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),_=function(){var e=Object(d.a)(u.a.mark((function e(t){var r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,T.a.get("".concat(U,"/").concat(t));case 2:return r=e.sent,e.abrupt("return",r.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),B=function(){var e=Object(d.a)(u.a.mark((function e(t,r){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,T.a.get("".concat(U,"/").concat(t,"/").concat(r));case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),H={getRecordingsByPage:_,getInitialRecordings:q,getRecordingsByDate:B},z=function(e){var t=e.dayIndex,r=e.index,n=e.recording;return Object(f.jsx)(g.h,{as:g.b,name:"recording-".concat(t,"-").concat(r),children:Object(f.jsxs)(g.a,{maxW:"445px",w:"full",bg:Object(k.c)("white","gray.900"),boxShadow:"2xl",rounded:"md",p:4,overflow:"hidden",children:[Object(f.jsx)(g.a,{bg:"gray.100",mt:-6,mx:-6,mb:6,pos:"relative",children:Object(f.jsx)(I.a,{name:"thumbnail-".concat(t,"-").concat(r),src:n.mediaThumbnailURL,layout:"fill"})}),Object(f.jsxs)(g.j,{name:"info-".concat(t,"-").concat(r),spacing:3,children:[Object(f.jsxs)(g.l,{children:[Object(f.jsx)(g.k,{as:R.b,color:"green.500"}),Object(f.jsxs)(g.i,{as:b.b,to:{pathname:"/dashboard/".concat(n._id),state:{recording:n}},children:[Object(f.jsx)("b",{children:"Date"})," ",new Date(n.mediaDate).toLocaleDateString()]})]}),Object(f.jsxs)(g.l,{children:[Object(f.jsx)(g.k,{as:R.d,color:"green.500"}),Object(f.jsx)("b",{children:"Time:"})," ",new Date(n.mediaDate).toLocaleTimeString()]})]}),Object(f.jsx)(g.r,{spacing:"10px",justify:"left",py:4,children:n.tags.map((function(e){return Object(f.jsx)(g.s,{children:Object(f.jsxs)(F.a,{variant:"subtle",colorScheme:e.color,children:[Object(f.jsx)(F.d,{boxSize:"12px",as:R.e}),Object(f.jsx)(F.c,{children:e.tag}),Object(f.jsx)(F.b,{})]})},e._id)}))})]})})},E=function(e){var t=e.dayIndex,r=e.dayDate,n=e.dayRecordings;return Object(f.jsxs)(g.a,{name:"recordings-".concat(t),p:4,children:[Object(f.jsx)(g.f,{children:new Date(r).toLocaleDateString()}),Object(f.jsx)(g.m,{minChildWidth:"300px",spacing:"40px",py:4,children:n.map((function(e,r){return Object(f.jsx)(z,{dayIndex:t,index:r,recording:e},e._id)}))})]})},W=function(e){var t=e.errorHandler,r=Object(n.useState)({recordings:[],loading:!1,isLastPage:!1,isFirstPage:!0}),a=Object(l.a)(r,2),c=a[0],s=a[1],i=Object(n.useRef)(),o=Object(n.useRef)(),j=Object(n.useCallback)(function(){var e=Object(d.a)(u.a.mark((function e(r){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,H.getRecordingsByDate(r.endpoint,r.requestedDate);case 3:n=e.sent,"before"===r.endpoint?0!==n.count?s((function(e){var t={recordings:[],loading:!1,isLastPage:!1,isFirstPage:e.isFirstPage},r=Object(S.a)(e.recordings);return r.length>=3?(t.isFirstPage=!1,t.recordings=r.slice(1).concat(n),t):(t.recordings=r.concat(n),t)})):s((function(e){return{recordings:e.recordings,loading:!1,isLastPage:!0,isFirstPage:e.isFirstPage}})):0!==n.count?s((function(e){var t={recordings:[],loading:!1,isLastPage:e.isLastPage,isFirstPage:!1},r=Object(S.a)(e.recordings);return r.length>=3?(t.isLastPage=!1,t.recordings=[n].concat(Object(S.a)(r.slice(0,-1))),t):(t.recordings=[n].concat(Object(S.a)(r)),t)})):s((function(e){return{recordings:e.recordings,loading:!1,isLastPage:e.isLastPage,isFirstPage:!0}})),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),"before"===r.endpoint?s((function(e){return{recordings:e.recordings,loading:!1,isLastPage:!0,isFirstPage:e.isFirstPage}})):s((function(e){return{recordings:e.recordings,loading:!1,isLastPage:e.isLastPage,isFirstPage:!0}})),t(e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t){return e.apply(this,arguments)}}(),[t]),b=Object(n.useCallback)((function(e){c.loading||(i.current&&i.current.disconnect(),i.current=new IntersectionObserver(function(){var e=Object(d.a)(u.a.mark((function e(t){var r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t[0].isIntersecting||c.isLastPage){e.next=5;break}return r={endpoint:"before",requestedDate:(new Date).toISOString()},c.recordings.length>0&&(r.requestedDate=c.recordings[c.recordings.length-1].recordings[c.recordings[c.recordings.length-1].recordings.length-1].mediaDate),e.next=5,j(r);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e&&i.current.observe(e))}),[c,j]),g=Object(n.useCallback)((function(e){c.loading||(o.current&&o.current.disconnect(),o.current=new IntersectionObserver(function(){var e=Object(d.a)(u.a.mark((function e(t){var r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t[0].isIntersecting||c.isFirstPage){e.next=5;break}return r={endpoint:"after",requestedDate:(new Date).toISOString()},c.recordings.length>0&&(r.requestedDate=c.recordings[0].recordings[0].mediaDate),e.next=5,j(r);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e&&o.current.observe(e))}),[c,j]);return Object(f.jsxs)(f.Fragment,{children:[Object(f.jsx)("div",{ref:g}),function(){for(var e=[],t=[],r=0,n=0;n<c.recordings.length;n++)t=t.concat(c.recordings[n].recordings),0===r&&(r=c.recordings[n]._id),n+1<c.recordings.length?c.recordings[n+1].date!==c.recordings[n].date&&(e.push(Object(f.jsx)(E,{dayIndex:n,dayDate:c.recordings[n].date,dayRecordings:t},r)),r=0,t=[]):e.push(Object(f.jsx)(E,{dayIndex:n,dayDate:c.recordings[n].date,dayRecordings:t},r));return e}(),Object(f.jsx)(p.a,{isLoaded:!c.loading,height:"20px",children:Object(f.jsx)("div",{ref:b,children:0===c.recordings.length&&!0===c.isLastPage&&"No results"})})]})},A=function(e){var t=e.videoUrl,r=e.mediaType;return Object(f.jsx)("video",{controls:!0,children:Object(f.jsx)("source",{src:t,type:r})})},J=function(e){var t,r=Object(j.g)().state.recording,n=r.mediaType.split("/");return console.log("mediatype: ",r.mediaType,"mediatypesplit: ",n),Object(f.jsxs)(g.c,{maxW:"5xl",children:[Object(f.jsx)(g.g,{as:b.b,to:"/dashboard",children:Object(f.jsx)(O.b,{"aria-label":"Go back",icon:Object(f.jsx)(R.a,{}),sx:(t={position:"-webkit-sticky"},Object(v.a)(t,"position","sticky"),Object(v.a)(t,"top","80px"),t)})}),Object(f.jsxs)(g.o,{textAlign:"center",align:"center",spacing:10,py:8,children:[Object(f.jsx)(g.d,{w:"full",children:"image"===n[0]?Object(f.jsx)(I.a,{src:r.mediaURL,alt:"Trail camera picture"}):Object(f.jsx)(A,{videoUrl:r.mediaURL,mediaType:r.mediaType})}),Object(f.jsxs)(g.o,{direction:{base:"column",md:"row"},children:[Object(f.jsx)(g.d,{flex:1,textAlign:"left",children:Object(f.jsx)(g.j,{spacing:3,children:Object.entries(r.emailBody).map((function(e){var t=Object(l.a)(e,2),r=t[0],n=t[1],a=R.c;return"temperature"===r?a=R.f:"date"===r?a=R.b:"time"===r&&(a=R.d),Object(f.jsxs)(g.l,{children:[Object(f.jsx)(g.k,{as:a,color:"green.500"}),Object(f.jsxs)("b",{children:[r,":"]})," ",n]},r)}))})}),Object(f.jsx)(g.d,{flex:1,children:Object(f.jsx)(g.r,{spacing:"10px",justify:"left",py:{base:4,md:0},children:r.tags.map((function(e){return Object(f.jsx)(g.s,{children:Object(f.jsxs)(F.a,{variant:"subtle",colorScheme:e.color,children:[Object(f.jsx)(F.d,{boxSize:"12px",as:R.e}),Object(f.jsx)(F.c,{children:e.tag}),Object(f.jsx)(F.b,{})]})},e._id)}))})})]})]})]})},G=function(e){var t=e.message;return null===t||0===t.length?null:Object(f.jsx)("div",{name:"notification",children:t})},M="/api/auth",N=function(){var e=Object(d.a)(u.a.mark((function e(t){var r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,T.a.post("".concat(M,"/login"),t);case 2:return r=e.sent,e.abrupt("return",r.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),K=function(){var e=Object(d.a)(u.a.mark((function e(){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,T.a.post("".concat(M,"/logout"));case 2:return t=e.sent,e.abrupt("return",t.data);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Q=function(){var e=Object(d.a)(u.a.mark((function e(){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,T.a.get(M);case 2:return t=e.sent,e.abrupt("return",t.data);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),V={login:N,logout:K,auth:Q},X=function(e){var t=e.user,r=e.loginUser,n=e.errorHandler;return Object(f.jsxs)(j.d,{children:[Object(f.jsx)(j.b,{path:"/login",children:null===t?Object(f.jsx)(m,{loginUser:r}):Object(f.jsx)(j.a,{to:"/dashboard"})}),Object(f.jsx)(j.b,{path:"/dashboard/:recordingId",children:null===t?Object(f.jsx)(j.a,{to:"/login"}):Object(f.jsx)(J,{})}),Object(f.jsx)(j.b,{path:"/dashboard",children:null===t?Object(f.jsx)(j.a,{to:"/login"}):Object(f.jsx)(W,{errorHandler:n})}),Object(f.jsx)(j.b,{children:null===t?Object(f.jsx)(j.a,{to:"/login"}):Object(f.jsx)(j.a,{to:"/dashboard"})})]})},Y=function(){var e=Object(n.useState)(null),t=Object(l.a)(e,2),r=t[0],a=t[1],c=Object(n.useState)(!0),s=Object(l.a)(c,2),i=s[0],o=s[1],j=Object(n.useState)(""),g=Object(l.a)(j,2),x=g[0],h=g[1],O=Object(n.useCallback)((function(e){e.response?401===e.response.status?(console.log(e.response.data.error),a(null)):e.response.data.error?console.log(e.response.data.error):console.log(e.response.data):console.log(e)}),[]);Object(n.useEffect)((function(){var e=function(){var e=Object(d.a)(u.a.mark((function e(){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,V.auth();case 3:t=e.sent,a(t),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),O(e.t0);case 10:return e.prev=10,o(!1),e.finish(10);case 13:case"end":return e.stop()}}),e,null,[[0,7,10,13]])})));return function(){return e.apply(this,arguments)}}();e()}),[O]);var m=function(){var e=Object(d.a)(u.a.mark((function e(t){var r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o(!0),e.prev=1,e.next=4,V.login(t);case 4:r=e.sent,a(r),h(""),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),e.t0.response.data.error?h(e.t0.response.data.error):h(e.t0.response.data);case 12:return e.prev=12,o(!1),e.finish(12);case 15:case"end":return e.stop()}}),e,null,[[1,9,12,15]])})));return function(t){return e.apply(this,arguments)}}(),v=function(){var e=Object(d.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,V.logout();case 3:a(null),h("Logout successful"),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),e.t0.response.data.error?h(e.t0.response.data.error):h(e.t0.response.data);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}();return Object(f.jsxs)(b.a,{children:[Object(f.jsx)(L,{loading:i,user:r,logout:v}),Object(f.jsx)(G,{message:x}),i?Object(f.jsx)(p.a,{height:"50px"}):Object(f.jsx)(X,{user:r,loginUser:m,errorHandler:O})]})};s.a.render(Object(f.jsx)(i.a,{children:Object(f.jsx)(a.a.StrictMode,{children:Object(f.jsx)(Y,{})})}),document.getElementById("root"))}},[[133,1,2]]]);
//# sourceMappingURL=main.0ee5f77b.chunk.js.map